#!/bin/sh
# v: open Neovim with system profile sourced
# Usage: v [ARGS...]
. /etc/profile
SOCKET="/tmp/nvim.sock"

# 1. Check if socket exists
if [ -S "$SOCKET" ]; then
  # 2. Open file(s) in existing instance
  # Use --remote-silent to avoid blocking or errors if args empty
  if [ "$#" -gt 0 ]; then
      nvr --servername "$SOCKET" --remote-silent "$@"
  fi

  # 3. Raise Window (via raise script)
  raise --match "class:regex=^nwim$"
  # Previous lsof implementation removed in favor of raise script interaction
else
  # 4. Start new instance acting as server
  # Use exec to replace shell process
  exec nvim --listen "$SOCKET" "$@"
fi
# vim:filetype=sh
