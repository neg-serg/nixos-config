#!/bin/sh
# v: open Neovim with system profile sourced
# Usage: v [ARGS...]
. /etc/profile
SOCKET="/tmp/nvim.sock"

# 1. Check if socket exists AND is responsive
if [ -S "$SOCKET" ] && nvr --servername "$SOCKET" --remote-expr "1" >/dev/null 2>&1; then
  # 2. Open file(s) in existing instance
  # Use --remote-silent to avoid blocking or errors if args empty
  if [ "$#" -gt 0 ]; then
      nvr --servername "$SOCKET" --remote-silent "$@"
  fi

  # 3. Raise Window (via hyprctl)
  hyprctl dispatch focuswindow "class:nwim" >/dev/null
  echo "â†—  nvim"
else
  # 4. Socket might be stale, remove it if it exists
  rm -f "$SOCKET"
  # Start new instance acting as server
  # Use exec to replace shell process
  exec nvim --listen "$SOCKET" "$@"
fi
# vim:filetype=sh
